{"version":3,"file":"index.umd.js","sources":["../src/index.js"],"sourcesContent":["import { Controller } from '@hotwired/stimulus';\nimport '@kanety/stimulus-static-actions';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    growWidth: String,\n    growHeight: String\n  }\n  static actions = [\n    ['element', 'dragenter->enter'],\n    ['element', 'dragleave->leave'],\n    ['element', 'drop->drop'],\n    ['element', 'dragover@document->overDoc'],\n    ['element', 'dragleave@document->leaveDoc'],\n    ['element', 'drop@document->dropDoc']\n  ];\n\n  get input() {\n    return this.scope.findElement('input[type=file]');\n  }\n\n  connect() {\n    this.counter = 0;\n  }\n\n  enter(e) {\n    e.preventDefault();\n    if (!this.isDroppable(e.dataTransfer)) return;\n\n    this.counter++;\n    this.toggleClass(e.dataTransfer, true);\n  }\n\n  leave(e) {\n    e.preventDefault();\n    if (!this.isDroppable(e.dataTransfer)) return;\n\n    this.counter--;\n    if (this.counter == 0) this.toggleClass(e.dataTransfer, false);\n  }\n\n  drop(e) {\n    e.preventDefault();\n    if (!this.isDroppable(e.dataTransfer)) return;\n\n    this.counter = 0;\n    this.toggleClass(e.dataTransfer, false);\n\n    let input = this.input;\n    if (input) {\n      input.files = e.dataTransfer.files;\n      input.dispatchEvent(new Event('input', { bubbles: true, cancelable: true }));\n      input.dispatchEvent(new Event('change', { bubbles: true, cancelable: true }));\n    }\n    this.dispatch('dropped', { detail: { files: e.dataTransfer.files } });\n  }\n\n  toggleClass(dataTransfer, dragover) {\n    if (dragover && this.isDroppable(dataTransfer)) {\n      this.element.classList.add('st-dropzone--dragover');\n    } else {\n      this.element.classList.remove('st-dropzone--dragover');\n    }\n  }\n\n  overDoc(e) {\n    e.preventDefault();\n    if (!this.isDroppable(e.dataTransfer)) return;\n\n    this.dragging = true;\n    this.dragin()\n  }\n\n  leaveDoc(e) {\n    e.preventDefault();\n    if (!this.isDroppable(e.dataTransfer)) return;\n\n    this.dragging = false;\n    if (this.timeout) clearTimeout(this.timeout);\n    this.timeout = setTimeout(() => {\n      if (!this.dragging) this.dragout();\n    } , 200);\n  }\n\n  dropDoc(e) {\n    e.preventDefault();\n    if (!this.isDroppable(e.dataTransfer)) return;\n\n    this.dragging = false;\n    this.dragout();\n  }\n\n  dragin() {\n    this.element.classList.add('st-dropzone--dragin');\n    if (this.growWidthValue) {\n      this.element.style.minWidth = this.growWidthValue;\n    }\n    if (this.growHeightValue) {\n      this.element.style.minHeight = this.growHeightValue;\n    }\n  }\n\n  dragout() {\n    this.element.classList.remove('st-dropzone--dragin');\n    if (this.growWidthValue) {\n      this.element.style.minWidth = '';\n    }\n    if (this.growHeightValue) {\n      this.element.style.minHeight = '';\n    }\n  }\n\n  isDroppable(dataTransfer) {\n    return dataTransfer.items.length && dataTransfer.items[0].kind == 'file' && this.isAllowedByInput(dataTransfer);\n  }\n\n  isAllowedByInput(dataTransfer) {\n    let input = this.input;\n    return !input || input.hasAttribute('multiple') || dataTransfer.items.length == 1;\n  }\n}\n"],"names":["Controller","input","scope","findElement","connect","this","counter","enter","e","preventDefault","isDroppable","dataTransfer","toggleClass","leave","drop","files","dispatchEvent","Event","bubbles","cancelable","dispatch","detail","dragover","element","classList","add","remove","overDoc","dragging","dragin","leaveDoc","timeout","clearTimeout","setTimeout","dragout","dropDoc","growWidthValue","style","minWidth","growHeightValue","minHeight","items","length","kind","isAllowedByInput","hasAttribute","values","growWidth","String","growHeight","actions"],"mappings":"+XAI6BA,aAcvBC,YACF,YAAYC,MAAMC,YAAY,oBAGhCC,UACEC,KAAKC,QAAU,EAGjBC,MAAMC,GACJA,EAAEC,iBACGJ,KAAKK,YAAYF,EAAEG,gBAExBN,KAAKC,UACLD,KAAKO,YAAYJ,EAAEG,cAAc,IAGnCE,MAAML,GACJA,EAAEC,iBACGJ,KAAKK,YAAYF,EAAEG,gBAExBN,KAAKC,UACe,GAAhBD,KAAKC,SAAcD,KAAKO,YAAYJ,EAAEG,cAAc,IAG1DG,KAAKN,GAEH,GADAA,EAAEC,iBACGJ,KAAKK,YAAYF,EAAEG,cAAxB,CAEAN,KAAKC,QAAU,EACfD,KAAKO,YAAYJ,EAAEG,cAAc,GAEjC,IAAIV,EAAQI,KAAKJ,MACbA,IACFA,EAAMc,MAAQP,EAAEG,aAAaI,MAC7Bd,EAAMe,cAAc,IAAIC,MAAM,QAAS,CAAEC,SAAS,EAAMC,YAAY,KACpElB,EAAMe,cAAc,IAAIC,MAAM,SAAU,CAAEC,SAAS,EAAMC,YAAY,MAEvEd,KAAKe,SAAS,UAAW,CAAEC,OAAQ,CAAEN,MAAOP,EAAEG,aAAaI,UAG7DH,YAAYD,EAAcW,GACpBA,GAAYjB,KAAKK,YAAYC,GAC/BN,KAAKkB,QAAQC,UAAUC,IAAI,yBAE3BpB,KAAKkB,QAAQC,UAAUE,OAAO,yBAIlCC,QAAQnB,GACNA,EAAEC,iBACGJ,KAAKK,YAAYF,EAAEG,gBAExBN,KAAKuB,UAAW,EAChBvB,KAAKwB,UAGPC,SAAStB,GACPA,EAAEC,iBACGJ,KAAKK,YAAYF,EAAEG,gBAExBN,KAAKuB,UAAW,EACZvB,KAAK0B,SAASC,aAAa3B,KAAK0B,SACpC1B,KAAK0B,QAAUE,WAAW,KACnB5B,KAAKuB,UAAUvB,KAAK6B,WACvB,MAGNC,QAAQ3B,GACNA,EAAEC,iBACGJ,KAAKK,YAAYF,EAAEG,gBAExBN,KAAKuB,UAAW,EAChBvB,KAAK6B,WAGPL,SACExB,KAAKkB,QAAQC,UAAUC,IAAI,uBACvBpB,KAAK+B,iBACP/B,KAAKkB,QAAQc,MAAMC,SAAWjC,KAAK+B,gBAEjC/B,KAAKkC,kBACPlC,KAAKkB,QAAQc,MAAMG,UAAYnC,KAAKkC,iBAIxCL,UACE7B,KAAKkB,QAAQC,UAAUE,OAAO,uBAC1BrB,KAAK+B,iBACP/B,KAAKkB,QAAQc,MAAMC,SAAW,IAE5BjC,KAAKkC,kBACPlC,KAAKkB,QAAQc,MAAMG,UAAY,IAInC9B,YAAYC,GACV,OAAOA,EAAa8B,MAAMC,QAAwC,QAA9B/B,EAAa8B,MAAM,GAAGE,MAAkBtC,KAAKuC,iBAAiBjC,GAGpGiC,iBAAiBjC,GACf,IAAIV,EAAQI,KAAKJ,MACjB,OAAQA,GAASA,EAAM4C,aAAa,aAA4C,GAA7BlC,EAAa8B,MAAMC,iBAlHjEI,OAAS,CACdC,UAAWC,OACXC,WAAYD,UAEPE,QAAU,CACf,CAAC,UAAW,oBACZ,CAAC,UAAW,oBACZ,CAAC,UAAW,cACZ,CAAC,UAAW,8BACZ,CAAC,UAAW,gCACZ,CAAC,UAAW"}