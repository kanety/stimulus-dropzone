{"version":3,"file":"index.module.js","sources":["../src/index.js"],"sourcesContent":["import { Controller } from '@hotwired/stimulus';\nimport '@kanety/stimulus-static-actions';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    growWidth: String,\n    growHeight: String\n  }\n  static actions = [\n    ['element', 'dragenter->enter'],\n    ['element', 'dragleave->leave'],\n    ['element', 'drop->drop'],\n    ['element', 'dragover@document->overDoc'],\n    ['element', 'dragleave@document->leaveDoc'],\n    ['element', 'drop@document->dropDoc']\n  ];\n\n  get input() {\n    return this.scope.findElement('input[type=file]');\n  }\n\n  connect() {\n    this.counter = 0;\n  }\n\n  enter(e) {\n    e.preventDefault();\n    if (!this.isDroppable(e.dataTransfer)) return;\n\n    this.counter++;\n    this.toggleClass(e.dataTransfer, true);\n  }\n\n  leave(e) {\n    e.preventDefault();\n    if (!this.isDroppable(e.dataTransfer)) return;\n\n    this.counter--;\n    if (this.counter == 0) this.toggleClass(e.dataTransfer, false);\n  }\n\n  drop(e) {\n    e.preventDefault();\n    if (!this.isDroppable(e.dataTransfer)) return;\n\n    this.counter = 0;\n    this.toggleClass(e.dataTransfer, false);\n\n    let input = this.input;\n    if (input) {\n      input.files = e.dataTransfer.files;\n      input.dispatchEvent(new Event('input', { bubbles: true, cancelable: true }));\n      input.dispatchEvent(new Event('change', { bubbles: true, cancelable: true }));\n    }\n    this.dispatch('dropped', { detail: { files: e.dataTransfer.files } });\n  }\n\n  toggleClass(dataTransfer, dragover) {\n    if (dragover && this.isDroppable(dataTransfer)) {\n      this.element.classList.add('st-dropzone--dragover');\n    } else {\n      this.element.classList.remove('st-dropzone--dragover');\n    }\n  }\n\n  overDoc(e) {\n    e.preventDefault();\n    if (!this.isDroppable(e.dataTransfer)) return;\n\n    this.dragging = true;\n    this.dragin()\n  }\n\n  leaveDoc(e) {\n    e.preventDefault();\n    if (!this.isDroppable(e.dataTransfer)) return;\n\n    this.dragging = false;\n    if (this.timeout) clearTimeout(this.timeout);\n    this.timeout = setTimeout(() => {\n      if (!this.dragging) this.dragout();\n    } , 200);\n  }\n\n  dropDoc(e) {\n    e.preventDefault();\n    if (!this.isDroppable(e.dataTransfer)) return;\n\n    this.dragging = false;\n    this.dragout();\n  }\n\n  dragin() {\n    this.element.classList.add('st-dropzone--dragin');\n    if (this.growWidthValue) {\n      this.element.style.minWidth = this.growWidthValue;\n    }\n    if (this.growHeightValue) {\n      this.element.style.minHeight = this.growHeightValue;\n    }\n  }\n\n  dragout() {\n    this.element.classList.remove('st-dropzone--dragin');\n    if (this.growWidthValue) {\n      this.element.style.minWidth = '';\n    }\n    if (this.growHeightValue) {\n      this.element.style.minHeight = '';\n    }\n  }\n\n  isDroppable(dataTransfer) {\n    return dataTransfer.items.length && dataTransfer.items[0].kind == 'file' && this.isAllowedByInput(dataTransfer);\n  }\n\n  isAllowedByInput(dataTransfer) {\n    let input = this.input;\n    return !input || input.hasAttribute('multiple') || dataTransfer.items.length == 1;\n  }\n}\n"],"names":["_Class","Controller","input","this","scope","findElement","connect","counter","enter","e","preventDefault","isDroppable","dataTransfer","toggleClass","leave","drop","files","dispatchEvent","Event","bubbles","cancelable","dispatch","detail","dragover","element","classList","add","remove","overDoc","dragging","dragin","leaveDoc","timeout","clearTimeout","setTimeout","dragout","dropDoc","growWidthValue","style","minWidth","growHeightValue","minHeight","items","length","kind","isAllowedByInput","hasAttribute","values","growWidth","String","growHeight","actions"],"mappings":"wFAIeA,MAAAA,UAAcC,EAc3B,SAAIC,GACF,OAAOC,KAAKC,MAAMC,YAAY,mBAChC,CAEAC,OAAAA,GACEH,KAAKI,QAAU,CACjB,CAEAC,KAAAA,CAAMC,GACJA,EAAEC,iBACGP,KAAKQ,YAAYF,EAAEG,gBAExBT,KAAKI,UACLJ,KAAKU,YAAYJ,EAAEG,cAAc,GACnC,CAEAE,KAAAA,CAAML,GACJA,EAAEC,iBACGP,KAAKQ,YAAYF,EAAEG,gBAExBT,KAAKI,UACe,GAAhBJ,KAAKI,SAAcJ,KAAKU,YAAYJ,EAAEG,cAAc,GAC1D,CAEAG,IAAAA,CAAKN,GAEH,GADAA,EAAEC,iBACGP,KAAKQ,YAAYF,EAAEG,cAAxB,CAEAT,KAAKI,QAAU,EACfJ,KAAKU,YAAYJ,EAAEG,cAAc,GAEjC,IAAIV,EAAQC,KAAKD,MACbA,IACFA,EAAMc,MAAQP,EAAEG,aAAaI,MAC7Bd,EAAMe,cAAc,IAAIC,MAAM,QAAS,CAAEC,SAAS,EAAMC,YAAY,KACpElB,EAAMe,cAAc,IAAIC,MAAM,SAAU,CAAEC,SAAS,EAAMC,YAAY,MAEvEjB,KAAKkB,SAAS,UAAW,CAAEC,OAAQ,CAAEN,MAAOP,EAAEG,aAAaI,QAT3D,CAUF,CAEAH,WAAAA,CAAYD,EAAcW,GACpBA,GAAYpB,KAAKQ,YAAYC,GAC/BT,KAAKqB,QAAQC,UAAUC,IAAI,yBAE3BvB,KAAKqB,QAAQC,UAAUE,OAAO,wBAElC,CAEAC,OAAAA,CAAQnB,GACNA,EAAEC,iBACGP,KAAKQ,YAAYF,EAAEG,gBAExBT,KAAK0B,UAAW,EAChB1B,KAAK2B,SACP,CAEAC,QAAAA,CAAStB,GACPA,EAAEC,iBACGP,KAAKQ,YAAYF,EAAEG,gBAExBT,KAAK0B,UAAW,EACZ1B,KAAK6B,SAASC,aAAa9B,KAAK6B,SACpC7B,KAAK6B,QAAUE,WAAW,KACnB/B,KAAK0B,UAAU1B,KAAKgC,SAAO,EAC9B,KACN,CAEAC,OAAAA,CAAQ3B,GACNA,EAAEC,iBACGP,KAAKQ,YAAYF,EAAEG,gBAExBT,KAAK0B,UAAW,EAChB1B,KAAKgC,UACP,CAEAL,MAAAA,GACE3B,KAAKqB,QAAQC,UAAUC,IAAI,uBACvBvB,KAAKkC,iBACPlC,KAAKqB,QAAQc,MAAMC,SAAWpC,KAAKkC,gBAEjClC,KAAKqC,kBACPrC,KAAKqB,QAAQc,MAAMG,UAAYtC,KAAKqC,gBAExC,CAEAL,OAAAA,GACEhC,KAAKqB,QAAQC,UAAUE,OAAO,uBAC1BxB,KAAKkC,iBACPlC,KAAKqB,QAAQc,MAAMC,SAAW,IAE5BpC,KAAKqC,kBACPrC,KAAKqB,QAAQc,MAAMG,UAAY,GAEnC,CAEA9B,WAAAA,CAAYC,GACV,OAAOA,EAAa8B,MAAMC,QAAwC,QAA9B/B,EAAa8B,MAAM,GAAGE,MAAkBzC,KAAK0C,iBAAiBjC,EACpG,CAEAiC,gBAAAA,CAAiBjC,GACf,IAAIV,EAAQC,KAAKD,MACjB,OAAQA,GAASA,EAAM4C,aAAa,aAA4C,GAA7BlC,EAAa8B,MAAMC,MACxE,EACD3C,EApHQ+C,OAAS,CACdC,UAAWC,OACXC,WAAYD,QACbjD,EACMmD,QAAU,CACf,CAAC,UAAW,oBACZ,CAAC,UAAW,oBACZ,CAAC,UAAW,cACZ,CAAC,UAAW,8BACZ,CAAC,UAAW,gCACZ,CAAC,UAAW"}