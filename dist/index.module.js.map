{"version":3,"file":"index.module.js","sources":["../src/index.js"],"sourcesContent":["import { Controller } from '@hotwired/stimulus';\nimport '@kanety/stimulus-static-actions';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    growWidth: String,\n    growHeight: String\n  }\n  static actions = [\n    ['element', 'dragenter->enter'],\n    ['element', 'dragleave->leave'],\n    ['element', 'drop->drop'],\n    ['element', 'dragover@document->overDoc'],\n    ['element', 'dragleave@document->leaveDoc'],\n    ['element', 'drop@document->dropDoc']\n  ];\n\n  get input() {\n    return this.scope.findElement('input[type=file]');\n  }\n\n  connect() {\n    this.counter = 0;\n  }\n\n  enter(e) {\n    this.counter++;\n    this.toggleClass(e.dataTransfer, true);\n    e.preventDefault();\n  }\n\n  leave(e) {\n    this.counter--;\n    if (this.counter == 0) this.toggleClass(e.dataTransfer, false);\n    e.preventDefault();\n  }\n\n  drop(e) {\n    this.counter = 0;\n    this.toggleClass(e.dataTransfer, false);\n\n    if (this.droppable(e.dataTransfer)) {\n      let input = this.input;\n      if (input) {\n        input.files = e.dataTransfer.files;\n        input.dispatchEvent(new Event('input', { bubbles: true, cancelable: true }));\n        input.dispatchEvent(new Event('change', { bubbles: true, cancelable: true }));\n      }\n      this.dispatch('dropped', { detail: { files: e.dataTransfer.files } });\n    }\n\n    e.preventDefault();\n  }\n\n  toggleClass(dataTransfer, dragover) {\n    if (dragover) {\n      this.element.classList.add('st-dropzone--dragover');\n      if (!this.droppable(dataTransfer)) {\n        this.element.classList.add('st-dropzone--disable-drop');\n      }\n    } else {\n      this.element.classList.remove('st-dropzone--dragover');\n      if (!this.droppable(dataTransfer)) {\n        this.element.classList.remove('st-dropzone--disable-drop');\n      }\n    }\n  }\n\n  overDoc(e) {\n    this.dragging = true;\n    this.dragin()\n    e.preventDefault();\n  }\n\n  leaveDoc(e) {\n    this.dragging = false;\n    if (this.timeout) clearTimeout(this.timeout);\n    this.timeout = setTimeout(() => {\n      if (!this.dragging) this.dragout();\n    } , 200);\n    e.preventDefault();\n  }\n\n  dropDoc(e) {\n    this.dragging = false;\n    this.dragout();\n    e.preventDefault();\n  }\n\n  dragin() {\n    this.element.classList.add('st-dropzone--dragin');\n    if (this.growWidthValue) {\n      this.element.style.minWidth = this.growWidthValue;\n    }\n    if (this.growHeightValue) {\n      this.element.style.minHeight = this.growHeightValue;\n    }\n  }\n\n  dragout() {\n    this.element.classList.remove('st-dropzone--dragin');\n    if (this.growWidthValue) {\n      this.element.style.minWidth = '';\n    }\n    if (this.growHeightValue) {\n      this.element.style.minHeight = '';\n    }\n  }\n\n  droppable(dataTransfer) {\n    let input = this.input;\n    return !input || input.hasAttribute('multiple') || dataTransfer.items.length == 1;\n  }\n}\n"],"names":["Controller","input","scope","findElement","connect","this","counter","enter","e","toggleClass","dataTransfer","preventDefault","leave","drop","droppable","files","dispatchEvent","Event","bubbles","cancelable","dispatch","detail","dragover","element","classList","add","remove","overDoc","dragging","dragin","leaveDoc","timeout","clearTimeout","setTimeout","dragout","dropDoc","growWidthValue","style","minWidth","growHeightValue","minHeight","hasAttribute","items","length","values","growWidth","String","growHeight","actions"],"mappings":"wGAI6BA,EAcvBC,YACF,YAAYC,MAAMC,YAAY,oBAGhCC,UACEC,KAAKC,QAAU,EAGjBC,MAAMC,GACJH,KAAKC,UACLD,KAAKI,YAAYD,EAAEE,cAAc,GACjCF,EAAEG,iBAGJC,MAAMJ,GACJH,KAAKC,UACe,GAAhBD,KAAKC,SAAcD,KAAKI,YAAYD,EAAEE,cAAc,GACxDF,EAAEG,iBAGJE,KAAKL,GAIH,GAHAH,KAAKC,QAAU,EACfD,KAAKI,YAAYD,EAAEE,cAAc,GAE7BL,KAAKS,UAAUN,EAAEE,cAAe,CAClC,IAAIT,EAAQI,KAAKJ,MACbA,IACFA,EAAMc,MAAQP,EAAEE,aAAaK,MAC7Bd,EAAMe,cAAc,IAAIC,MAAM,QAAS,CAAEC,SAAS,EAAMC,YAAY,KACpElB,EAAMe,cAAc,IAAIC,MAAM,SAAU,CAAEC,SAAS,EAAMC,YAAY,MAEvEd,KAAKe,SAAS,UAAW,CAAEC,OAAQ,CAAEN,MAAOP,EAAEE,aAAaK,SAG7DP,EAAEG,iBAGJF,YAAYC,EAAcY,GACpBA,GACFjB,KAAKkB,QAAQC,UAAUC,IAAI,yBACtBpB,KAAKS,UAAUJ,IAClBL,KAAKkB,QAAQC,UAAUC,IAAI,+BAG7BpB,KAAKkB,QAAQC,UAAUE,OAAO,yBACzBrB,KAAKS,UAAUJ,IAClBL,KAAKkB,QAAQC,UAAUE,OAAO,8BAKpCC,QAAQnB,GACNH,KAAKuB,UAAW,EAChBvB,KAAKwB,SACLrB,EAAEG,iBAGJmB,SAAStB,GACPH,KAAKuB,UAAW,EACZvB,KAAK0B,SAASC,aAAa3B,KAAK0B,SACpC1B,KAAK0B,QAAUE,WAAW,KACnB5B,KAAKuB,UAAUvB,KAAK6B,WACvB,KACJ1B,EAAEG,iBAGJwB,QAAQ3B,GACNH,KAAKuB,UAAW,EAChBvB,KAAK6B,UACL1B,EAAEG,iBAGJkB,SACExB,KAAKkB,QAAQC,UAAUC,IAAI,uBACvBpB,KAAK+B,iBACP/B,KAAKkB,QAAQc,MAAMC,SAAWjC,KAAK+B,gBAEjC/B,KAAKkC,kBACPlC,KAAKkB,QAAQc,MAAMG,UAAYnC,KAAKkC,iBAIxCL,UACE7B,KAAKkB,QAAQC,UAAUE,OAAO,uBAC1BrB,KAAK+B,iBACP/B,KAAKkB,QAAQc,MAAMC,SAAW,IAE5BjC,KAAKkC,kBACPlC,KAAKkB,QAAQc,MAAMG,UAAY,IAInC1B,UAAUJ,GACR,IAAIT,EAAQI,KAAKJ,MACjB,OAAQA,GAASA,EAAMwC,aAAa,aAA4C,GAA7B/B,EAAagC,MAAMC,UA3GjEC,OAAS,CACdC,UAAWC,OACXC,WAAYD,UAEPE,QAAU,CACf,CAAC,UAAW,oBACZ,CAAC,UAAW,oBACZ,CAAC,UAAW,cACZ,CAAC,UAAW,8BACZ,CAAC,UAAW,gCACZ,CAAC,UAAW"}